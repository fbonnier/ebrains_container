# ====== Model-Runner ======= #
FROM ubuntu:20.04 AS model-runner


ENV TZ=Europe/Kiev

EXPOSE 667

# Set default shell
SHELL ["/bin/bash", "-c"]

# Set timezone
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# Update system and install requirements
COPY apt_requirements_469e4b78-8b3b-459d-88b6-c9ad10ee11ea.txt apt_requirements.txt
RUN apt-get -y update && apt-get -y upgrade;
RUN xargs apt-get -y install --no-install-recommends < apt_requirements.txt

# Install NEURON 7.4
# RUN wget -N --no-check-certificate https://www.neuron.yale.edu/ftp/neuron/versions/v7.4/nrn-7.4.x86_64.deb
# RUN apt-get install -y ./nrn-7.4.x86_64.deb
# RUN apt-get -y install -f

RUN apt-get autoremove -y && \
    rm -rf /var/lib/apt/lists/* 


# Set Python Virtual Environment
# RUN python3 -m ensurepip --upgrade
COPY requirements_469e4b78-8b3b-459d-88b6-c9ad10ee11ea.txt requirements.txt
RUN pip3 install --no-cache-dir --upgrade pip setuptools wheel
RUN pip3 install --no-cache-dir -r requirements.txt


# Install model
RUN wget -N https://data-proxy.ebrains.eu/api/v1/buckets/pc0a33-human_cells/cell0603_11_model_937.zip
RUN unzip cell0603_11_model_937.zip

